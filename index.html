<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country Map with OpenLayers</title>
    <script src="https://cdn.jsdelivr.net/npm/ol@v8.1.0/dist/ol.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v8.1.0/ol.css">
    <script src="https://cdn.jsdelivr.net/npm/ol-geocoder@4.3.1/dist/ol-geocoder.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/ol-geocoder@4.3.1/dist/ol-geocoder.min.css" rel="stylesheet">
    <style>
        /* CSS to position the slider */
        .map-container {
            position: relative;
            width: 100%;
        }

        #map {
            width: 100%;
            height: 800px;
        }

        #opacitySlider {
            position: absolute;
            top: 100px;
            left: -103px;
            transform: rotate(270deg);
            transform-origin: 100% 100%;
        }
    </style>
</head>
<body>
    <div class="map-container">
        <div id="map" class="map"></div>
        <input type="range" id="opacitySlider" min="0" max="1" step="0.01" value="0.5">
    </div>

    <script>
        // Map views always need a projection.  Here we just want to map image
        // coordinates directly to map coordinates, so we create a projection that uses
        // the image extent in pixels.
        var extent = [5.42, 49.215, 6.571, 50.304]; // [minX, minY, maxX, maxY]
        var imageLayerVisible = true; // Track the visibility of the image layer
        var map;
        var imageLayer;
        var geocoder;

        function updateImageOpacity(opacity) {
            // Update the opacity of the image layer
            imageLayer.setOpacity(opacity);
        }

        function updateImageExtent(newExtent) {
            extent = newExtent;

            // Create a new ol.source.ImageStatic with the updated extent
            var newImageSource = new ol.source.ImageStatic({
                url: 'lux_geology.png', // Replace with your image URL or path
                projection: 'EPSG:4326',
                imageExtent: extent
            });

            // Set the new source for the image layer
            imageLayer.setSource(newImageSource);
        }

        map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                }),
                (imageLayer = new ol.layer.Image({
                    source: new ol.source.ImageStatic({
                        url: 'lux_geology.png', // Replace with your image URL or path
                        projection: 'EPSG:4326',
                        imageExtent: extent
                    }),
                    opacity: 0.7 // Set the initial opacity (50% transparent)
                }))
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([6.1, 49.8]), // Centered in Luxembourg
                zoom: 6 // You can adjust the zoom level as needed
            })
        });

        var MULLERTHAL = [6.3075, 49.7904];
        // Create a point feature at a specific coordinate
        var point = new ol.Feature({
            geometry: new ol.geom.Point(ol.proj.fromLonLat(MULLERTHAL)) // Set the coordinate of the point
        });

        // Style for the point (you can customize this)
        var pointStyle = new ol.style.Style({
            image: new ol.style.Circle({
                radius: 7,
                fill: new ol.style.Fill({ color: 'red' }),
                stroke: new ol.style.Stroke({ color: 'white', width: 2 })
            })
        });

        point.setStyle(pointStyle);

        // Create a vector layer to display the point
        var vectorLayer = new ol.layer.Vector({
            source: new ol.source.Vector({
                features: [point]
            })
        });

        // Add the vector layer to the map
        map.addLayer(vectorLayer);

        // Initialize the OpenLayers Geocoder
        geocoder = new Geocoder('nominatim', {
            provider: 'osm',
            lang: 'en-US',
            placeholder: 'Search for a location...',
            limit: 5,
            debug: false,
            autoComplete: true,
            keepOpen: true,
        });

        // Add the geocoder control to the map
        map.addControl(geocoder);

        // Handle geocoder result selection
        geocoder.on('addresschosen', function(event) {
            var feature = event.feature;
            console.log(feature)
            var coordinates = feature.getGeometry().getCoordinates();
            map.getView().animate({
                center: coordinates,
                zoom: 10,
                duration: 1000,
            });
        });

        ///////////////////
        // EVENT LISTENERS
        ///////////////////

        // Add a keydown event listener to the document
        document.addEventListener('keydown', function(event) {
            if (event.key === 'g' || event.key === 'G') {
                // Toggle the visibility of the image layer
                imageLayerVisible = !imageLayerVisible;
                map.getLayers().getArray()[1].setVisible(imageLayerVisible);
            }
        });
        // Add an input event listener to the opacity slider
        var opacitySlider = document.getElementById('opacitySlider');
        opacitySlider.addEventListener('input', function() {
            var opacity = parseFloat(opacitySlider.value);
            updateImageOpacity(opacity);
        });
    </script>
</body>
</html>
